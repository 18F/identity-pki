input {
  beats {
    port => 5044
    ssl => true
    ssl_certificate => "<%= @mycrt %>"
    ssl_key => "<%= @mykey %>"
  }
}

filter { 
  # Rails Events
  if [source] == "/srv/idp/shared/log/events.log" {
    json {
      source => "message"
      target => "events"
    }
  }
  # Rails Production
  if [source] == "/srv/idp/shared/log/production.log" {
    if [message] =~ "^\{" {
      json {
        source => "message"
        target => "rails"
      }
    }
    if [message] =~ "^source" {
      kv {
        target => "rack"
      }
    }
  }
  # Nginx access and error
  if [source] == "/var/log/nginx/*.log" {
    kv {
      target => "nginx"
    }
  }
}
