name: No CloudTrail Logs
type: flatline
index: logstash-cloudtrail*
alert_text: logs from cloudtrail in the <%= @env %> ELK instance seem to have stopped entirely!
owner: <%= @env %>
threshold: <%= @thresholds['cloudtrail'] %>
realert:
    hours: 2
doc_type: _doc
scan_entire_timeframe: true
# This timeframe is somewhat large, but cloudtrail logs are slow to arrive,
# so sometimes we run dry.  This helps by looking back a bit further.  It means we won't get
# alerted as quickly, but we need to make sure we don't cry wolf here with false-positives.
timeframe:
    minutes: 60
use_count_query: true
alert:
<% if ! @emails.empty? %>
- "email"
<% end %>
<% if ! @webhook.nil? %>
- "slack"
<% end %>
<% if ! @emails.empty? %>
email:
<%   @emails.each do |e| %>
- "<%= e %>"
<%   end %>
<% end %>
<% if ! @webhook.nil? %>
slack_webhook_url: <%= @webhook %>
slack_username_override: <%= "#{@env} alerts" %>
slack_channel_override: ["<%= @slackchannel %>"]
<% end %>
