# Install Node.js from nodesource Apt repo

node_version = '8.x'

# https://deb.nodesource.com/gpgkey/nodesource.gpg.key
# GPG key 9FD3B784BC1C6FC31A8A0A1C1655A0AB68576280
file '/etc/apt/trusted.gpg.d/nodesource.gpg' do
  content(Base64.decode64(<<-EOM
mQINBFObJLYBEADkFW8HMjsoYRJQ4nCYC/6Eh0yLWHWfCh+/9ZSIj4w/pOe2V6V+W6DHY3kK3a+2
bxrax9EqKe7uxkSKf95gfns+I9+R+RJfRpb1qvljURr54y35IZgsfMG22Np+TmM2RLgdFCZa18h0
+RbH9i0b+ZrB9XPZmLb/h9ou7SowGqQ3wwOtT3Vyqmif0A2GCcjFTqWW6TXaY8eZJ9BCEqW3k/0C
jw7K/mSy/utxYiUIvZNKgaG/P8U789QyvxeRxAf93YFAVzMXhoKxu12IuH4VnSwAfb8gQyxKRyiG
OUwk0YoBPpqRnMmDDl7SdmY3oQHEJzBelTMjTM8AjbB9mWoPBX5G8t4u47/FZ6PgdfmRg9hsKXhk
LJc7C1btblOHNgDx19fzASWX+xOjZiKpP6MkEEzq1bilUFul6RDtxkTWsTa5TGixgCB/G2fK8I9J
L/yQhDc6OGY9mjPOxMb5PgUlT8ox3v8wt25erWj9z30QoEBwfSg4tzLcJq6N/iepQemNfo6Is+TG
+JzI6vhXjlsBm/Xmz0ZiFPPObAH/vGCY5I6886vXQ7ftqWHYHT8jz/R4tigMGC+tvZ/kcmYBsLCC
I5uSEP6JJRQQhHrCvOX0UaytItfsQfLmEYRd2F72o1yGh3yvWWfDIBXRmaBuIGXGpajC0JyBGSOW
b9UxMNZY/2LJEwARAQABtB9Ob2RlU291cmNlIDxncGdAbm9kZXNvdXJjZS5jb20+iQI4BBMBAgAi
BQJTmyS2AhsDBgsJCAcDAgYVCAIJCgsEFgIDAQIeAQIXgAAKCRAWVaCraFdigHTmD/9OKhUyjJ+h
8gMRg6ri5EQxOExccSRU0i7UHktecSs0DVC4lZG9AOzBe+Q36cym5Z1di6JQkHl69q3zBdV3KTW+
H1pdmnZlebYGz8paG9iQ/wS9gpnSeEyx0Enyi167Bzm0O4A1GK0prkLnz/yROHHEfHjsTgMvFwAn
f9uaxwWgE1d1RitIWgJpAnp1DZ5O0uVlsPPmXAhuBJ32mU8S5BezPTuJJICwBlLYECGb1Y65Cil4
OALU7T7sbUqfLCuaRKxuPtcUVnJ6/qiyPygvKZWhV6Od0Yxlyed1kftMJyYoL8kPHfeHJ+vIyt0s
7cropfiwXoka1iJB5nKyt/eqMnPQ9aRpqkm9ABS/r7AauMA/9RALudQRHBdWIzfIg0Mlqb52yyTI
IgQJHNGNX1T3z1XgZhI+Vi8SLFFSh8x9FeUZC6YJu0VXXj5iz+eZmk/nYjUt4MtcpVsVYIB7oIDI
bImODm8ggsgrIzqxOzQVP1zsCGek5U6QFc9GYrQ+Wv3/fG8hfkDnxXLww0OGaEQxfodm8cLFZ5b8
JaG3+Yxfe7JkNclwvRimvlAjqIiW5OK0vvfHco+YgANhQrlMnTx//IdZssaxvYytSHpPZTYw+qPE
jbBJOLpoLrz8ZafN1uekpAqQjffIAOqW9SdIzq/kSHgl0bzWbPJPw86XzzftewjKNbACAAO5Ag0E
U5sktgEQAMUknUIvlqT0GXzn5ZMfbGCWtHFsy5dsPvhUJ2dT5+RdPQ/5DzDYeKjrMr11pXpGlf0r
Hg2bVc4hySpulfEwRt35ZhZQtw1kHzTRcJ+fqVkgfFhxuG0wOUcmBBGH6W3pDLXaFlv0aPCpoeNZ
7sWQ0rgSYQ3hSKdHHJzdi6daOl3yHg2D3oMhD0kmaq7nX6i60mYUrQ5SYF43miY1ulD+rcT7WGmo
pWvfx5+rxfOwEOW0dnRFgf8USc4DcEYmseyklNMXGusQLn/kw8Qo2eaadicHQo6rly05lJ2yGfSx
leeFGfzHohvMlbuqcW4hp16OBJG5OsYItXsC4rxps+EEX1ZJVdHW2t2Y9H0aM32dtqlB8QnwzO2n
dHgVzBZh4jfIYNyFB0zvlHZV/2h94AAxQL0lQ79L/LenRnOlxPQ6+5hhBZ0DBzuM4TNR2ktjYdE4
i9rRS7bS23xuaEJcQn11/f52rI9yvap5RIPRt/uE+5aXT5mUUXtTvHBwiOYplYOnCyIgSzztentH
yshyIGLMC3ayRX2hzWDP0licR6V+/ec5/ogsMr2UpS3x/ZpXoDnlZo/XMoTf1Tpkt0EYZWF6ANs+
1mUzaAuogCJciKTE3Ga/p7WhlbRTi0un8HQag145kkLuupgysFORJHzZW8q6c2TMhQg1hGKOACEf
9fGhmQWFABEBAAGJAh8EGAECAAkFAlObJLYCGwwACgkQFlWgq2hXYoCD0BAAnGIfK0dfcDGWf4YG
L+bKOmNR3CTQEbs5n30CqM0v68annNMTN8HHi9QCDLhoZVxXhndMEb/0Vc3mY50xsITdQ5wg8tSO
uoVE4HoTjbH1Wp7j9T2SqC9/BAMbDM3WIJGB+k/WuMCR/yD7frrhUxRct6PEyjLymiZPfPibKdl/
0LjcYaqXCBmlW7UNW5+5vpOUHv38/mxblHlz4r2nyy5RnOim3YDL0lvRFTDu8gcv9iRNeWSYJe5V
yi0N9VUDwB092p+SFdgv4ntdnhKmVpZwoh1f8E/s4TpEqVna4XlnwU/mnIUeIwx/NAEtxfI6N28k
AEyW90aAmFAlXN7taLoTWWuci4GGf4mZKZOYCo8Rz7nRWw3Vo2xn5TfZNe1Qn+GfcgG/UDKh8x8C
Bl62+68hXLkTjAiy1VKdOz6060cZzvQP+McRAotJfwczcXlNYCvPIRGjYyH74j0f4ehquijnDSmf
K1RXcBaY278BzEAVoa6n7htymnj725zmyh16XyCqADO19qnzviBZyxkz8oRU3K5er2QUzGU32Ygt
Vw0C7hlJ3bHJLlyDSFNwxVs2Rq9EK6pLhP48q+xV3lCY/Qe3C6PrP016PkWlX4t5DnPQaMSL8v6o
jRrP0ystv1I6qf2n35iDKDF0qMypoGvNSUsJAAztSTIFMunQKV8/ZD+BBN6wAgAD
  EOM
  ))
  sensitive true # not secret, but useless for humans
end

apt_repository 'nodesource' do
  uri "https://deb.nodesource.com/node_#{node_version}"
  distribution node.fetch('lsb').fetch('codename')
  components ['main']
  deb_src true
end

apt_package 'nodejs' do
  action :upgrade
end
