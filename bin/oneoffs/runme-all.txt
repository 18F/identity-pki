# remove this file once the AWS Provider v4 deploys are complete
set -euo pipefail

TERRAFORM_ENV=$1
AWS_ACCT_NUM=$(grep -m1 aws_account_id "terraform/all/${TERRAFORM_ENV}/env-vars.sh" | awk -F'"' '{print $2}')

#####################################################################################
##### if any command below fails, comment out the preceding commands and re-run
##### this script file. do not comment out any of the above lines!
#####################################################################################

bin/td -d all -e ${TERRAFORM_ENV} -s rm 'module.main.aws_s3_bucket_object.tfslackchannel'
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_object.tfslackchannel' "login-gov.secrets.${AWS_ACCT_NUM}-us-west-2/tfslackchannel"

bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_acl.awsmacietrail_dataevent' "login-gov.awsmacietrail-dataevent.${AWS_ACCT_NUM}-us-west-2,private"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_acl.config_recorder' "config-bucket-${AWS_ACCT_NUM},private"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.internal_certificates_bucket.aws_s3_bucket_acl.secrets' "login-gov.internal-certs.${AWS_ACCT_NUM}-us-west-2,private"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.main_secrets_bucket.aws_s3_bucket_acl.secrets' "login-gov.secrets.${AWS_ACCT_NUM}-us-west-2,private"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_acl.s3-access-logs' "login-gov.s3-access-logs.${AWS_ACCT_NUM}-us-west-2,log-delivery-write"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_acl.s3-logs' "login-gov.s3-logs.${AWS_ACCT_NUM}-us-west-2,log-delivery-write"

bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_lifecycle_configuration.awsmacietrail_dataevent' "login-gov.awsmacietrail-dataevent.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_lifecycle_configuration.cloudtrail' "login-gov-cloudtrail-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_lifecycle_configuration.config_recorder' "config-bucket-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_lifecycle_configuration.s3-access-logs' "login-gov.s3-access-logs.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_lifecycle_configuration.s3-logs' "login-gov.s3-logs.${AWS_ACCT_NUM}-us-west-2"

bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_logging.awsmacietrail_dataevent' "login-gov.awsmacietrail-dataevent.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_logging.cloudtrail' "login-gov-cloudtrail-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_logging.config_recorder' "config-bucket-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.internal_certificates_bucket.aws_s3_bucket_logging.secrets' "login-gov.internal-certs.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.main_secrets_bucket.aws_s3_bucket_logging.secrets' "login-gov.secrets.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_logging.inventory' "login-gov.s3-inventory.${AWS_ACCT_NUM}-us-west-2"

bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_policy.awsmacietrail_dataevent' "login-gov.awsmacietrail-dataevent.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_policy.cloudtrail' "login-gov-cloudtrail-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_policy.inventory' "login-gov.s3-inventory.${AWS_ACCT_NUM}-us-west-2"

bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_server_side_encryption_configuration.awsmacietrail_dataevent' "login-gov.awsmacietrail-dataevent.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_server_side_encryption_configuration.cloudtrail' "login-gov-cloudtrail-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_server_side_encryption_configuration.config_recorder' "config-bucket-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.internal_certificates_bucket.aws_s3_bucket_server_side_encryption_configuration.secrets' "login-gov.internal-certs.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.main_secrets_bucket.aws_s3_bucket_server_side_encryption_configuration.secrets' "login-gov.secrets.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_server_side_encryption_configuration.inventory' "login-gov.s3-inventory.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_server_side_encryption_configuration.s3-access-logs' "login-gov.s3-access-logs.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_server_side_encryption_configuration.s3-logs' "login-gov.s3-logs.${AWS_ACCT_NUM}-us-west-2"

bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_versioning.awsmacietrail_dataevent' "login-gov.awsmacietrail-dataevent.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_versioning.cloudtrail' "login-gov-cloudtrail-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.aws_s3_bucket_versioning.config_recorder' "config-bucket-${AWS_ACCT_NUM}"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.internal_certificates_bucket.aws_s3_bucket_versioning.secrets' "login-gov.internal-certs.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.main_secrets_bucket.aws_s3_bucket_versioning.secrets' "login-gov.secrets.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_versioning.inventory' "login-gov.s3-inventory.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_versioning.s3-access-logs' "login-gov.s3-access-logs.${AWS_ACCT_NUM}-us-west-2"
bin/td -d all -e ${TERRAFORM_ENV} -i 'module.main.module.tf-state.aws_s3_bucket_versioning.s3-logs' "login-gov.s3-logs.${AWS_ACCT_NUM}-us-west-2"