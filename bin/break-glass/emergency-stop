#!/usr/bin/env python3

  # Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
  #
  # Licensed under the Apache License, Version 2.0 (the "License").
  # You may not use this file except in compliance with the License.
  # A copy of the License is located at
  #
  #     http://www.apache.org/licenses/LICENSE-2.0
  #
  # or in the "license" file accompanying this file. This file is distributed
  # on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
  # express or implied. See the License for the specific language governing
  # permissions and limitations under the License.


from click import command, option
from boto3 import client

@command()
@option("--vpc", "-v", envvar="VPC_ID", required=True)
@option("--region", "-r", envvar="REGION_AWS", required=False, default='us-west-2')
def main(vpc,region):
    ec2_cli = client('ec2', region_name=region)

    route_tables_r = ec2_cli.describe_route_tables(
        Filters=[
            {
                'Name': 'vpc-id',
                'Values': [
                    vpc
                ]
            }
        ]
    )['RouteTables']

    for routes in route_tables_r:
        route_table_id=routes['RouteTableId']
        print('For route table: {rt_id}'.format(rt_id=route_table_id))
        for route in routes['Routes']:
            try:

                if route['DestinationCidrBlock'] == '0.0.0.0/0':
                    # delete route for internet
                    print('Deleting route for internet cidr 0.0.0.0/0, gateway id: {gw_id}.'.format(gw_id=route['GatewayId']))
                    delete_route_r = ec2_cli.delete_route(
                    DestinationCidrBlock='0.0.0.0/0',
                    RouteTableId=route_table_id
                )
                    print('Deleted route. Response metadata: {rmtdt}'.format(rmtdt=delete_route_r['ResponseMetadata']))
                # else:
                #     print('no internet route for cidr {cidr}, gateway id: {gw_id}'.format(cidr=route['DestinationCidrBlock'],gw_id=route['GatewayId']))
            except KeyError:
                pass
if __name__ == '__main__':
    main()