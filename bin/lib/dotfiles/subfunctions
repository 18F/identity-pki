#!/bin/bash

######## sub-functions ########
## print full command before running ##
USE_RUN=1
run() {
  if [[ $USE_RUN -gt 0 ]] ; then
    if [ -t 1 ]; then
      echo -ne "\\033[1;36m"
    fi

    echo >&2 "+ $*"

    if [ -t 1 ]; then
      echo -ne '\033[m'
    fi
  fi
  "$@"
}

## print $usage and return 1 ##
badopt() {
  echo "Usage: ${usage}"
  break 1
}

# set a variable AND print its declaration to the console
run_var() {
  VAR=${1}
  shift
  if [ -t 1 ]; then
    echo -ne "\\033[1;36m"
  fi

  echo -e >&2 "+ $VAR=\$($*)"

  if [ -t 1 ]; then
    echo -ne '\033[m'
  fi
  T=$($@)
  # Set variable value by reference to avoid ; shenanigans
  eval "${VAR}=\"\${T}\""
}
