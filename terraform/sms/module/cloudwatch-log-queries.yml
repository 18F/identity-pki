---
pinpoint-events/any:
  logs:
    - /aws/lambda/pinpoint_event_logger
  query: |
    # Show all PinPoint message events
    filter ispresent(event_type)
    | fields @timestamp, event_type, attributes.record_status, attributes.iso_country_code, @message

pinpoint-events/pct-failure-by-country:
  logs:
    - /aws/lambda/pinpoint_event_logger
  query: |
    filter ispresent(event_type)
    | stats 100 * sum(event_type!="_SMS.FAILIRE") / count() as pct_failure by attributes.iso_country_code as iso_country_code
    | sort pct_failure desc

pinpoint-events/spend-by-country:
  logs:
    - /aws/lambda/pinpoint_event_logger
  query: |
    filter ispresent(event_type)
    | stats sum(metrics.price_in_millicents_usd) * 0.00001 as USD by attributes.iso_country_code as iso_country_code
    | sort USD desc

pinpoint-events/send-by-country:
  logs:
    - /aws/lambda/pinpoint_event_logger
  query: |
    filter ispresent(attributes.iso_country_code)
    | stats count() as SENT by attributes.iso_country_code as iso_country_code
    | sort SENT desc
