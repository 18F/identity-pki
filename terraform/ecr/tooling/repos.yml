default_read_template: &all_write_template
  ecr_repo_tag_mutability: "MUTABLE"
  tags:
    gitlab_alpha_build-pool: "write"
    gitlab_bravo_build-pool: "write"
    gitlab_charlie_build-pool: "write"
    gitlab_alpha_test-pool: "read"
    gitlab_bravo_test-pool: "read"
    gitlab_charlie_test-pool: "read"

# Disallow any write access from gitlab processes, including runners.
readonly_template: &readonly_template
  ecr_repo_tag_mutability: "MUTABLE"
  tags: {}

# If you add an existing repo, you may need to import the state, e.g.
# tf-deploy ecr/tooling import 'module.repos["gitlab-qa"].aws_ecr_repository.ecr_repo' gitlab-qa

repos:
  alpha:
    name: "alpha/base"
    <<: *all_write_template
  alpine:
    name: "ecr-public/docker/library/alpine"
    <<: *all_write_template
  alpine_git:
    name: "alpine/git"
    <<: *all_write_template
  env_deploy:
    name: "cd/env_deploy"
    <<: *all_write_template
  env_stop:
    name: "cd/env_stop"
    <<: *all_write_template
  env_test:
    name: "cd/env_test"
    <<: *all_write_template
  env_deploy_blessed:
    name: "cd/env_deploy/blessed"
    <<: *readonly_template
  env_stop_blessed:
    name: "cd/env_stop/blessed"
    <<: *readonly_template
  env_test_blessed:
    name: "cd/env_test/blessed"
    <<: *readonly_template
  fluent-bit:
    name: "amazon/aws-for-fluent-bit"
    <<: *all_write_template
  gitaly:
    name: "gitlab-org/build/cng/gitaly"
    <<: *all_write_template
  gitlabdemo:
    name: "gitlabdemo"
    <<: *all_write_template
  gitlab_deploy:
    name: "cd/gitlab_deploy"
    <<: *all_write_template
  gitlab-qa:
    name: "gitlab-qa"
    <<: *all_write_template
  gitlab_test:
    name: "cd/gitlab_test"
    <<: *all_write_template
  gitlab_deploy_blessed:
    name: "cd/gitlab_deploy/blessed"
    <<: *readonly_template
  gitlab_test_blessed:
    name: "cd/gitlab_test/blessed"
    <<: *readonly_template
  golang:
    name: "ecr-public/docker/library/golang"
    <<: *all_write_template
  idp_ci:
    name: "idp/ci"
    <<: *all_write_template
  pivcac_ci:
    name: "pivcac/ci"
    <<: *all_write_template
  nginx:
    name: "ecr-public/nginx/nginx"
    <<: *all_write_template
  postgres:
    name: "ecr-public/docker/library/postgres"
    <<: *all_write_template
  redis:
    name: "ecr-public/docker/library/redis"
    <<: *all_write_template
  ruby:
    name: "ecr-public/docker/library/ruby"
    <<: *all_write_template
  ruby-node-yarn-chrome-chromedriver:
    name: "ruby-node-yarn-chrome-chromedriver"
    <<: *all_write_template
  tspencertest:
    name: "tspencertest"
    <<: *all_write_template
  tspencertestreview:
    name: "tspencer/tspencertestreview"
    <<: *all_write_template
  identity_pivcac_review:
    name: "identity-pivcac/review"
    <<: *all_write_template
  identity_pivcac_review_cache:
    name: "identity-pivcac/review/cache"
    <<: *all_write_template
  identity_dashboard_review:
    name: "identity-dashboard/review"
    <<: *all_write_template
  identity_dashboard_review_cache:
    name: "identity-dashboard/review/cache"
    <<: *all_write_template
  dashboard_ci:
    name: "dashboard/ci"
    <<: *all_write_template
  identity_idp:
    name: "identity-idp/idp"
    <<: *all_write_template
  identity_idp_cache:
    name: "identity-idp/idp/cache"
    <<: *all_write_template
  gitlab-runner:
    name: "ecr-public/gitlab/gitlab-runner"
    <<: *all_write_template
  gitlab-runner-helper:
    name: "ecr-public/gitlab/gitlab-runner-helper"
    <<: *all_write_template
  gitlab-runner-helper:
    name: "ecr-public/gitlab/gitlab-runner-helper"
    <<: *all_write_template
  kyverno:
    name: "kyverno/kyverno"
    <<: *all_write_template
  kyvernobgcontroller:
    name: "kyverno/background-controller"
    <<: *all_write_template
  kyvernocleanup:
    name: "kyverno/cleanup-controller"
    <<: *all_write_template
  kyvernopre:
    name: "kyverno/kyvernopre"
    <<: *all_write_template
  kyvernoreports:
    name: "kyverno/reports-controller"
    <<: *all_write_template