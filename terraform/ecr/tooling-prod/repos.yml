default_read_template: &all_write_template
  ecr_repo_tag_mutability: "MUTABLE"
  tags:
    gitlab_production_build-pool: "write"
    gitlab_production_test-pool: "read"

# Disallow any write access from gitlab processes, including runners.
readonly_template: &readonly_template
  ecr_repo_tag_mutability: "MUTABLE"
  tags: {}

# If you add an existing repo, you may need to import the state, e.g.
# tf-deploy ecr/tooling import 'module.repos["gitlab-qa"].aws_ecr_repository.ecr_repo' gitlab-qa

repos:
  alpine:
    name: "ecr-public/docker/library/alpine"
    <<: *readonly_template
  aws_cli:
    name: "ecr-public/aws-cli/aws-cli"
    <<: *readonly_template
  env_deploy:
    name: "cd/env_deploy"
    <<: *all_write_template
  env_stop:
    name: "cd/env_stop"
    <<: *all_write_template
  env_test:
    name: "cd/env_test"
    <<: *all_write_template
  env_deploy_blessed:
    name: "cd/env_deploy/blessed"
    <<: *readonly_template
  env_stop_blessed:
    name: "cd/env_stop/blessed"
    <<: *readonly_template
  env_test_blessed:
    name: "cd/env_test/blessed"
    <<: *readonly_template
  gitlab_deploy:
    name: "cd/gitlab_deploy"
    <<: *all_write_template
  gitlab_test:
    name: "cd/gitlab_test"
    <<: *all_write_template
  gitlab_deploy_blessed:
    name: "cd/gitlab_deploy/blessed"
    <<: *readonly_template
  gitlab_test_blessed:
    name: "cd/gitlab_test/blessed"
    <<: *readonly_template
  golang:
    name: "ecr-public/docker/library/golang"
    <<: *readonly_template
  idp_ci:
    name: "idp/ci"
    lifecycle_policies_enabled: false
    <<: *all_write_template
  pivcac_ci:
    name: "pivcac/ci"
    lifecycle_policies_enabled: false
    <<: *all_write_template
  postgres:
    name: "ecr-public/docker/library/postgres"
    <<: *readonly_template
  redis:
    name: "ecr-public/docker/library/redis"
    <<: *readonly_template
  ruby:
    name: "ecr-public/docker/library/ruby"
    <<: *readonly_template
  tf_deploy:
    name: "cd/tf_deploy"
    <<: *all_write_template
  identity_idp_review:
    name: "identity-idp/review"
    lifecycle_policy_settings: {
      days: 10
    }
    <<: *all_write_template
  identity_idp_review_cache:
    name: "identity-idp/review/cache"
    <<: *all_write_template
  identity_idp:
    name: "identity-idp/idp"
    lifecycle_policy_settings: {
      days: 40
    }
    <<: *all_write_template
  identity_idp_cache:
    name: "identity-idp/idp/cache"
    <<: *all_write_template
  identity_pivcac_review:
    name: "identity-pivcac/review"
    lifecycle_policy_settings: {
      days: 40
    }
    <<: *all_write_template
  identity_pivcac_review_cache:
    name: "identity-pivcac/review/cache"
    <<: *all_write_template
  identity_pivcac:
    name: "identity-pivcac/pivcac"
    <<: *all_write_template
  identity_pivcac_nginx:
    name: "identity-pivcac/nginx"
    <<: *all_write_template
  identity_pivcac_cache:
    name: "identity-pivcac/pivcac/cache"
    <<: *all_write_template
  identity_configmaploader:
    name: "identity-configmaploader/configmaploader"
    <<: *all_write_template
  gitlab_dast:
    name: "gitlab/dast"
    <<: *all_write_template
  identity_dashboard_review:
    name: "identity-dashboard/review"
    lifecycle_policy_settings: {
      days: 40
    }
    <<: *all_write_template
  identity_dashboard_review_cache:
    name: "identity-dashboard/review/cache"
    <<: *all_write_template
  dashboard_ci:
    name: "dashboard/ci"
    <<: *all_write_template
  saml_sinatra_ci:
    name: "saml_sinatra/ci"
    <<: *all_write_template
  oidc_sinatra_ci:
    name: "oidc_sinatra/ci"
    <<: *all_write_template
  cloudfoundry_cd:
    name: "cloudfoundry/cd"
    <<: *all_write_template
  tf_deploy_blessed:
    name: "cd/tf_deploy/blessed"
    <<: *all_write_template
  gitlab-runner:
    name: "ecr-public/gitlab/gitlab-runner"
    <<: *all_write_template
  tf_eks_plan_apply:
    name: "cd/tf_eks_plan_apply"
    <<: *all_write_template
  tf_eks_plan_apply_blessed:
    name: "cd/tf_eks_plan_apply/blessed"
    <<: *readonly_template
  gitlab-runner-helper:
    name: "ecr-public/gitlab/gitlab-runner-helper"
    <<: *all_write_template
  kubectl:
    name: "ecr-public/bitnami/kubectl"
    <<: *all_write_template
  dns_check_lambda:
    name: "dns_check_lambda"
    <<: *all_write_template
  kyverno:
    name: "kyverno/kyverno"
    <<: *all_write_template
  kyvernobgcontroller:
    name: "kyverno/background-controller"
    <<: *all_write_template
  kyvernocleanup:
    name: "kyverno/cleanup-controller"
    <<: *all_write_template
  kyvernopre:
    name: "kyverno/kyvernopre"
    <<: *all_write_template
  kyvernoreports:
    name: "kyverno/reports-controller"
    <<: *all_write_template
  tspencertest:
    name: "tspencertest"
    <<: *all_write_template
  eks_deploy:
    name: "eks_deploy"
    <<: *all_write_template
  ## third party helm chart images
  # argo-rollouts
  argo-rollouts:
    name: "quay/argoproj/argo-rollouts"
    <<: *readonly_template
  argo-rollouts-dashboard:
    name: "quay/argoproj/kubectl-argo-rollouts"
    <<: *readonly_template
  # argocd
  argocd:
    name: "quay/argoproj/argocd"
    <<: *readonly_template
  dex:
    name: "github/dexidp/dex"
    <<: *readonly_template
  argo-extensions:
    name: "quay/argoprojlabs/argocd-extension-installer"
    <<: *readonly_template
  # aws-load-balancer-controller
  # (nothing)
  # cert-manager
  cert-manager:
    name: "quay/jetstack/cert-manager-controller"
    <<: *readonly_template
  cert-manager-webhook:
    name: "quay/jetstack/cert-manager-webhook"
    <<: *readonly_template
  cert-manager-cainjector:
    name: "quay/jetstack/cert-manager-cainjector"
    <<: *readonly_template
  cert-manager-acmesolver:
    name: "quay/jetstack/cert-manager-acmesolver"
    <<: *readonly_template
  cert-manager-startupapicheck:
    name: "quay/jetstack/cert-manager-startupapicheck"
    <<: *readonly_template
  # cluster-autoscaler
  cluster-autoscaler:
    name: "kubernetes/autoscaling/cluster-autoscaler"
    <<: *readonly_template
  # external-dns
  # (nothing)
  # falco
  redis-stack:
    name: "docker-hub/redis/redis-stack"
    <<: *readonly_template
  # fluent-bit
  fluent-bit:
    name: "docker-hub/fluent/fluent-bit"
    <<: *readonly_template
  # ingress-nginx
  ingress-nginx:
    name: "kubernetes/ingress-nginx/controller"
    <<: *readonly_template
  ingress-nginx-opentelemetry:
    name: "kubernetes/ingress-nginx/opentelemetry"
    <<: *readonly_template
  ingress-nginx-webhook:
    name: "kubernetes/ingress-nginx/kube-webhook-certgen"
    <<: *readonly_template
  # kuma
  kuma-cni:
    name: "docker-hub/kumahq/kuma-cni"
    <<: *readonly_template
  kuma-cp:
    name: "docker-hub/kumahq/kuma-cp"
    <<: *readonly_template
  kumactl:
    name: "docker-hub/kumahq/kumactl"
    <<: *readonly_template
  kuma-init:
    name: "docker-hub/kumahq/kuma-init"
    <<: *readonly_template
  kuma-dp:
    name: "docker-hub/kumahq/kuma-dp"
    <<: *readonly_template
  # kyverno
  gh-kyverno:
    name: "github/kyverno/kyverno"
    <<: *readonly_template
  gh-kyvernopre:
    name: "github/kyverno/kyvernopre"
    <<: *readonly_template
  background-controller:
    name: "github/kyverno/background-controller"
    <<: *readonly_template
  cleanup-controller:
    name: "github/kyverno/cleanup-controller"
    <<: *readonly_template
  reports-controller:
    name: "github/kyverno/reports-controller"
    <<: *readonly_template
  # metrics-server
  metrics-server:
    name: "kubernetes/metrics-server/metrics-server"
    <<: *readonly_template
  addon-resizer:
    name: "kubernetes/autoscaling/addon-resizer"
    <<: *readonly_template
  # node-local-dns
  node-local-dns:
    name: "kubernetes/dns/k8s-dns-node-cache"
    <<: *readonly_template
  # pgbouncer
  # (nothing)
  # policy-reporter
  policy-reporter:
    name: "github/kyverno/policy-reporter"
    <<: *readonly_template
  policy-reporter-kyverno-plugin:
    name: "github/kyverno/policy-reporter-kyverno-plugin"
    <<: *readonly_template
  policy-reporter-ui:
    name: "github/kyverno/policy-reporter-ui"
    <<: *readonly_template
  # prometheus
  prometheus:
    name: "quay/prometheus/prometheus"
    <<: *readonly_template
  prometheus-config-reloader:
    name: "quay/prometheus-operator/prometheus-config-reloader"
    <<: *readonly_template
  prometheus-alertmanager:
    name: "quay/prometheus/alertmanager"
    <<: *readonly_template
  prometheus-node-exporter:
    name: "quay/prometheus/node-exporter"
    <<: *readonly_template
  prometheus-pushgateway:
    name: "quay/prometheus/pushgateway"
    <<: *readonly_template
  kube-state-metrics:
    name: "kubernetes/kube-state-metrics/kube-state-metrics"
    <<: *readonly_template
